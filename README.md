# Sacculina Genome Project
A workflow for genome assembly, annotation and differential expression analysis of Sacculina carcini

## Introduction

A few arthropods evolved towards an endoparasites and show a dramatic change in body shape and anatomy, often barely resembling arthropods at all. The parasitic barnacle Sacculina carcini (Crustacea: Rhizocephala) is one prominent example in evolutionary transformation due to an endoparasitic lifestyle. The adults show no sign of their arthropod kin: segmentation, appendages and most of the internal organs usually found in arthropods are completely missing. The adult body is divided into two parts: a network of rootlets growing in the body cavity of the crab hosts and a temporary breeding sac, bearing gonads and keeping first larval stages. There is a good record of studies on morphology and life cycle, but almost nothing is known about the genome of rhizocephalan species. 

This project aims to get a better understanding about the genetic and genomic foundations of this extreme modification of morphology. Assembly and annotation of the genome and differential gene expression focussing rootlet and breeding sac. Also a comparison to the standard repertoire of other arthropod genomes and a new survey genomes dataset of the non-parasitic barnacle Balanus amphitrite was performed.

Here we document the analysis steps and provide a snakmake workflow.

Sequences can be accessed under NCBI: 
https://www.ncbi.nlm.nih.gov/bioproject/659937


## Prerequisites

Anaconda3 and singularity.

conda environment.yaml -> update to latest packages and adjust versions!

This workflow was developed and run on a cluster environment with the SGE as a resource management system. Jobscripts containing the individual snakemake commands are included. For some steps of this workflow we need to activate module files, which are specific to the underlying system. This might need to be adjusted when running on another system. Also two singularity containers are required and some conda environments. Conda environments that are needed for the snakemake steps are generated by snakemake prior to the analysis or as an initial setup step. For this an internet connection is needed to be able to download all dependent packages.


# Workflow

Different steps of the workflow are performed with snakemake. Each step can be started individually and we also provide a Jobscript for a SGE queuingsystem.


## Genome assembly

The assembled genome and the corresponding raw data can be accessed via NCBI: https://www.ncbi.nlm.nih.gov/bioproject/659937

The Genome was assembled with a combination of Nanopore long reads and Mate-Pair shortreads of an 8kb library. The longreads were filtered by length and only reads longer than 3kb were kept. Next the longreads were trimmed with PORECHOP  and assembled with FLYE. The illumina short reads were trimmed with FASTP and mapped to the flye assembly with BWA and sorted with SAMTOOLS. The Flye assembly was scaffolded with BESST and the mapped shortreads. Finally the draft assembly was improved with two rounds of pilon.

The assembly was submitted to NCBI where a vector screen was performed. After cleaning the Genome assembly it was used for further analyis.

## Genome annotation 

Prior to starting the workflow we need to download and setup some reference data. 

  - By running the program 02_download_TSA_cirripedia.sh you will download all available TSA to the direcroty resources/external_TSA/. Also a file is generated that contains information about the taxon name and file name. All samples that should be included in the analyis should be placed in a file in workflow/config/ and refered to under workflow/config/config.yaml -> sample_external:
  - Download RNA-Seq reads for the denovo assembly of additional cirripedia transcriptomes [bash 02_download_RNA-Seq.sh]
  - run Remove_isoforms.py to download Genomes and GFFs (download links provided via Download_links_orthofinder_sed.csv) and also select only the longest aminacid sequence per gene [python Remove_isoforms.py --infile Download_links_orthofinder_set.csv]. These protein sets will be used for an orthofinder run, as reference for the genome annotation and to compare with the Sacculina carcini gene prediction.
  - we also need to make sure that the RNA-Seq data of Sacculina carcini is located in the resources/RNA-Seq/ directory and that the file names correspond to those in the workflow/config/config.yaml -> sample_info (in this example: workflow/config/Sacculina_samplefile.txt )
  - for some busco runs we need to make sure that resources/busco_config.ini is matching to our system setup.
  - funannotate_setup: for the funannotate prediction we need some databases that can be downloaded. This can be done with the following snakemake command: snakemake --until funannotate_setup --snakefile workflow/Snakefile_annotation --use-singularity --singularity-args "--home $PWD" --singularity-args "--bind $PWD/temp/:/tmp/" --cores 1 
(configurations can be adjusted in the workflow/config/config.yaml file)

Genome annotation is performed with FUNANNOTATE. We use the genome and RNA-Seq data for training and external data during the prediction. The predicte protein sequences are further analysed with interproscan and this information is also added to the annotation.

## Comparative genomics

To compare Sacculina carcini protein predictions to other species we run an orthofinder analysis. We download a set of 17 reference species (descibed above) and select the longest isoform.
Then we run orthofinder on the external protein sequences, add the gene prediction from Sacculina carcini and also reroot the generated phylogenetic tree, so it fits better to the literature.
Based on the orthofinder output we generate some graphs on duplicationsevents, gene loss and most recent common ancesteral orthogroups.

## Differential Expression analysis

Analysis of differentially expressed genes were performed on three samples, two originating from tissue samples from the interna and one from the externa. RNA-Seq reads were mapped to the genome sequence and then assembled with trinity. After the assembly additional steps were performed to add information about GO terms with the help of TRINOTATE.  Differential expression analysis was mainly done with helperscripts from trinity.
We estimated abundance by mapping reads to the transcriptome assembly, for each sample. We used RSEM to estimate expression values. 

# Citation

# References
- conda
- singularity
- snakemake
- trinity
- fastp
- flye
- BESST
- pilon
- blast
- hmmer
- funannotate
- orthofinder
- hisat2
- samtools
- seqkit

# Funding 
This project was funded by the Deutsche Forschungsgemeinschaft (DFG) - Project number 252344899

https://gepris.dfg.de/gepris/projekt/252344899



